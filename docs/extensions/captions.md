# `la.captions`

This extension lets you assign captions to document elements, and wraps them (as appropriate) in the HTML elements intended for this purpose: `<figcaption>` within `<figure>`, and/or `<caption>` within `<table>`.

Once so structured, these figures, tables and captions can be styled with CSS and numbered using [`la.labels`](labels.md).

To caption an element:

1. Write the caption itself as an ordinary Markdown paragraph ([or block quote](#complex)) _before_ the element you are captioning, with a paragraph break in between.

2. Attach the `-caption` directive to the caption. (The `attr_list` extension will be loaded automatically for this purpose, but you can also use [`la.attr_prefix`](attr_prefix.md).)


## Basic Example

Here's how it works in simple cases:

/// markdown-demo
    extra_files:
        - ['diagram1.svg', 'Diagram', 'svg', False]
    show_html_body: True
    output_height: 28em

    import lamarkdown as la
    la('la.captions')
    la.css('''
        figure { border: 1px solid gray;
                 padding: 1em; }
    ''')
    ---
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
    "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
    <!-- Generated by graphviz version 9.0.0 (0)
    -->
    <!-- Title: Diagram Pages: 1 -->
    <svg width="134pt" height="106pt"
    viewBox="0.00 0.00 134.21 106.41" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 102.41)">
    <title>Diagram</title>
    <polygon fill="white" stroke="none" points="-4,4 -4,-102.41 130.21,-102.41 130.21,4 -4,4"/>
    <!-- A -->
    <g id="node1" class="node">
    <title>A</title>
    <polygon fill="pink" stroke="black" points="54,-97.93 0,-97.93 0,-61.93 54,-61.93 54,-97.93"/>
    <text text-anchor="middle" x="27" y="-75.26" font-family="Times,serif" font-size="14.00">A</text>
    </g>
    <!-- B -->
    <g id="node2" class="node">
    <title>B</title>
    <polygon fill="lightyellow" stroke="black" points="126.21,-98.41 72.21,-98.41 72.21,-62.41 126.21,-62.41 126.21,-98.41"/>
    <text text-anchor="middle" x="99.21" y="-75.73" font-family="Times,serif" font-size="14.00">B</text>
    </g>
    <!-- A&#45;&gt;B -->
    <g id="edge1" class="edge">
    <title>A&#45;&gt;B</title>
    <path fill="none" stroke="black" d="M54.3,-80.11C56.36,-80.13 58.47,-80.14 60.59,-80.15"/>
    <polygon fill="black" stroke="black" points="60.33,-83.65 70.36,-80.22 60.38,-76.65 60.33,-83.65"/>
    </g>
    <!-- C -->
    <g id="node3" class="node">
    <title>C</title>
    <polygon fill="lightblue" stroke="black" points="90.59,-36 36.59,-36 36.59,0 90.59,0 90.59,-36"/>
    <text text-anchor="middle" x="63.59" y="-13.32" font-family="Times,serif" font-size="14.00">C</text>
    </g>
    <!-- B&#45;&gt;C -->
    <g id="edge2" class="edge">
    <title>B&#45;&gt;C</title>
    <path fill="none" stroke="black" d="M88.71,-62.02C85.91,-57.11 82.82,-51.69 79.79,-46.38"/>
    <polygon fill="black" stroke="black" points="82.88,-44.74 74.88,-37.79 76.8,-48.21 82.88,-44.74"/>
    </g>
    <!-- C&#45;&gt;A -->
    <g id="edge3" class="edge">
    <title>C&#45;&gt;A</title>
    <path fill="none" stroke="black" d="M52.81,-36.25C49.93,-41.12 46.76,-46.5 43.64,-51.77"/>
    <polygon fill="black" stroke="black" points="40.67,-49.91 38.6,-60.3 46.7,-53.47 40.67,-49.91"/>
    </g>
    </g>
    </svg>
    ---
    Some ordinary document text.

    A diagram for your
    consideration.
    {-caption}

    ![Important diagram](diagram1.svg)

    Some more ordinary document text.
///


!!! note "Design Notes"

    An alternate (hypothetical) approach would be to write captions as values of the `-caption` directive itself, e.g.:

    ```markdown
    {-caption="A diagram for your consideration."}
    ![Important diagram](diagram1.svg)

    <!-- Not actually how it works! -->
    ```

    This alternate approach would be unnecessarily limiting, because no Markdown processing occurs within attribute values. Thus, a caption would be limited to a single paragraph of text devoid of formatting, links, or any other semantic structure. There seems no advantage to this.

    Also, in the actual approach taken, captions must be written _above_ (not below) their captioned elements, because:

    * This is consistent with the traditional placement of table captions.

    * Though figure captions traditionally appear underneath figures, this applies to formatted documents, where figures can be viewed as the pictures or diagrams they are intended to be. In Markdown, the code representing a figure usually won't have any meaning on its own, at a glance.

    * We need a consistent rule. We can't permit captions to appear _either_ above _or_ below, without creating ambiguity or additional complexity.

    This only applies to the `.md` file itself. The HTML document can be styled so that captions appear anywhere you wish.


## Tables

When captioning a table, the HTML structure will use the `<table>` and `<caption>` elements. (The default styling may show the caption protruding outside the physical table boundary, but it's still logically part of the table.)

/// markdown-demo
    show_html_body: True

    import lamarkdown as la
    la('la.captions', 'tables')
    la.css('''
        table  { border: 1px solid red; }
        td, th { border: 1px solid blue; }
    ''')
    ---
    A table for your
    consideration.
    {-caption}

    Heading A | Heading B
    --------- | ---------
    One       | Two
    Three     | Four
///


## Complex Captions {#complex}

If a caption requires more than one paragraph and/or other block elements, then:

1. You can represent it using the Markdown "block quote" syntax (prefixing lines with `>`), _but also_
2. You will need to use [`la.attr_prefix`](attr_prefix.md) in order to attach the `-caption` directive _above_ the block quote. (You can do this regardless, even in simpler cases, if you wish.)

/// markdown-demo
    extra_files:
        - ['diagram1.svg', 'Diagram', 'svg', False]
    show_html_body: True
    output_height: 30em

    import lamarkdown as la
    la('la.captions', 'la.attr_prefix')
    la.css('figure { border: 1px solid gray; '
           '         padding: 1em; }')
    ---
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
    "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
    <!-- Generated by graphviz version 9.0.0 (0)
    -->
    <!-- Title: Diagram Pages: 1 -->
    <svg width="134pt" height="106pt"
    viewBox="0.00 0.00 134.21 106.41" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 102.41)">
    <title>Diagram</title>
    <polygon fill="white" stroke="none" points="-4,4 -4,-102.41 130.21,-102.41 130.21,4 -4,4"/>
    <!-- A -->
    <g id="node1" class="node">
    <title>A</title>
    <polygon fill="pink" stroke="black" points="54,-97.93 0,-97.93 0,-61.93 54,-61.93 54,-97.93"/>
    <text text-anchor="middle" x="27" y="-75.26" font-family="Times,serif" font-size="14.00">A</text>
    </g>
    <!-- B -->
    <g id="node2" class="node">
    <title>B</title>
    <polygon fill="lightyellow" stroke="black" points="126.21,-98.41 72.21,-98.41 72.21,-62.41 126.21,-62.41 126.21,-98.41"/>
    <text text-anchor="middle" x="99.21" y="-75.73" font-family="Times,serif" font-size="14.00">B</text>
    </g>
    <!-- A&#45;&gt;B -->
    <g id="edge1" class="edge">
    <title>A&#45;&gt;B</title>
    <path fill="none" stroke="black" d="M54.3,-80.11C56.36,-80.13 58.47,-80.14 60.59,-80.15"/>
    <polygon fill="black" stroke="black" points="60.33,-83.65 70.36,-80.22 60.38,-76.65 60.33,-83.65"/>
    </g>
    <!-- C -->
    <g id="node3" class="node">
    <title>C</title>
    <polygon fill="lightblue" stroke="black" points="90.59,-36 36.59,-36 36.59,0 90.59,0 90.59,-36"/>
    <text text-anchor="middle" x="63.59" y="-13.32" font-family="Times,serif" font-size="14.00">C</text>
    </g>
    <!-- B&#45;&gt;C -->
    <g id="edge2" class="edge">
    <title>B&#45;&gt;C</title>
    <path fill="none" stroke="black" d="M88.71,-62.02C85.91,-57.11 82.82,-51.69 79.79,-46.38"/>
    <polygon fill="black" stroke="black" points="82.88,-44.74 74.88,-37.79 76.8,-48.21 82.88,-44.74"/>
    </g>
    <!-- C&#45;&gt;A -->
    <g id="edge3" class="edge">
    <title>C&#45;&gt;A</title>
    <path fill="none" stroke="black" d="M52.81,-36.25C49.93,-41.12 46.76,-46.5 43.64,-51.77"/>
    <polygon fill="black" stroke="black" points="40.67,-49.91 38.6,-60.3 46.7,-53.47 40.67,-49.91"/>
    </g>
    </g>
    </svg>
    ---
    {-caption}
    > A diagram for your
    > consideration.
    >
    > It requires some complex explanation:
    >
    > * First, here's a list item.
    > * Second, there's another.

    ![Important diagram](diagram1.svg)
///


## Options

{-list-table}

* #
    - Option
    - Description

*   - `directives`
    - An object for retrieving directives from HTML tree elements. This should be an instance of `lamarkdown.lib.directives.Directives`, and the extension will reuse Lamarkdown's "current" instance by default, if available.

*   - `progress`
    - An object accepting error, warning and progress messages. This should be an instance of `lamarkdown.lib.Progress`, and the extension will reuse Lamarkdown's "current" instance by default, if available.

*   - `autowrap_listings`
    - `False` by default. If `True`, wrap all code listings (`<pre>` elements containing a `<code>` element) in a `<figure>` element, even where no caption is provided. The theory is that listings are often less in need of a caption than ordinary figures or tables, but it may still be desirable to have them automatically numbered with the [`la.labels`](labels.md) extension (which would otherwise ignore them).

*   - `autowrap_maths`
    - `False` by default. If `True`, wrap all block-style MathML (`<math>`) elements in a `<figure>` element, even when no caption is provided. The same reasoning applies as for `autowrap_listings`.
